{% extends "layout.html" %}

{% block content %}
<h1 class="mx-3 admin-page-title">
    <i class="fa-solid fa-users"></i> Visitor Administration<br />
    <small>The list of playing visitors</small>
</h1>

<div class="container-fluid px-0">
    <div class="row my-4">
        <div class="col-4">
            <div class="ms-3 p-3 bg-body shadow-sm admin-panel-container">
                <div id="reader"></div>
            </div>
        </div>
        <div class="col-8">
            <div class="me-3 p-3 bg-body shadow-sm admin-panel-container">
            test2
            </div>

        </div>

    </div>
</div>

<div class="my-4 mx-3 p-3 bg-body shadow-sm admin-panel-container">
    <h5 class="border-bottom pb-2 mb-0">Visitors</h5>
    <form id='visitor-filter-form' class="mt-3" onsubmit="return false;" hx-encoding='multipart/form-data' hx-trigger="input from:#search-form, input from:[type='checkbox'], click from:#clearButton" hx-get='/admin/visitors/table' hx-ext='json-enc' hx-swap="innerHTML" hx-target="#visitor-table"> 
        <div class="mb-3">
            <label for="uid_filter" class="form-label">Filter by UID:</label>
            <div class="container-fluid px-0">
                <div class="row">
                    <div class="col-8">
                        <input type="text" id="uid_filter" name="uid_filter" class="form-control" hx-trigger="keyup delay:500ms" hx-get='/admin/visitors/table' hx-swap="innerHTML" hx-target="#visitor-table">
                    </div>
                    <div class="col-4">
                        <button class="btn btn-primary" id="clearButton" onclick="document.getElementById('uid_filter').value='';">
                            <i class="fa-solid fa-filter-circle-xmark"></i>
                            Clear
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" checked id="still_playing" name="still_playing">
            <label class="form-check-label" for="still_playing">
                Show only visitors still playing
            </label>
        </div>
    </form>
    <div id="visitor-table" hx-get="/admin/visitors/table?still_playing=true" hx-trigger="load" hx-swap="innerHTML"></div>
</div>

<script src="/static/js/html5-qrcode.js"></script>
<script>
    function onScanSuccess(decodedText, decodedResult) {
      const inputElement = document.getElementById("uid_filter");
      inputElement.value=decodedText;
      inputElement.dispatchEvent(new Event('keyup'));
    }

    function onScanFailure(error) {
    }
    document.addEventListener('DOMContentLoaded', function() {
        let html5QrcodeScanner = new Html5QrcodeScanner(
            "reader",
            { fps: 10, qrbox: {width: 100, height: 100} },
            false
        );
        html5QrcodeScanner.render(onScanSuccess, onScanFailure);
    }, false);
    
</script>  
{% endblock %}
